<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Taklit</title>
    <style>
        #main {
            display: flex;
            justify-content: center;
            text-align: center;
        }

        .animated {
            position: relative;
            opacity: 0;
            transform: translateY(300px);
            transition: all 1.2s ease-out;
        }

        .animated.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <div id="main">
        <div id="vinyl"></div>
        <div id="song"></div>
    </div>
    <script>
        function getContainer(name) {
            return document.getElementById(name);
        }

        function onEnd(text) {
            getContainer("main").textContent = text
        }

        function onVinyl(vinyl) {
            const tracklist = vinyl.tracklist || []

            return `
                <h1>${vinyl.album_name}</h1>
                <h2>${vinyl.artist}</h2>
                <h3>${vinyl.year}</h3>
                <h3>${vinyl.genre}</h3>
                <div>${tracklist.map(track => `<span>${track}</span>`).join("<br>")}</div>
            `
        }

        function onSong(song) {
            return `
                <h1>${song.title}</h1>
                <h2>${song.artist}</h2>
                <h3>${song.live_lyrics}</h3>
                <div></div>
            `
        }

        function onData(data) {

            const animatedContainer = document.createElement('div')
            animatedContainer.classList.add("animated")

            let container;
            if (data.data_type === "vinyl") {
                container = getContainer("vinyl")
                animatedContainer.innerHTML = onVinyl(data)
            } else {
                container = getContainer("song")
                animatedContainer.innerHTML = onSong(data)
            }

            container.innerHTML = ""
            container.appendChild(animatedContainer)

            setTimeout(() => {
                animatedContainer.classList.add('show');
            }, 10); // Small delay to ensure transition triggers
        }

        // Create a WebSocket connection to the server
        const socket = new WebSocket('ws://localhost:5000/ws');

        // Event listener for when the connection is opened
        socket.onopen = function (event) {
            console.log('WebSocket connection established');
        };


        // Event listener for when the connection is closed
        socket.onclose = function (event) {
            onEnd('WebSocket connection closed');
        };

        // Event listener for WebSocket errors
        socket.onerror = function (error) {
            onEnd('WebSocket error: ', error);
        };

         // Event listener for receiving messages from the server
         socket.onmessage = function(event) {
            onData(JSON.parse(event.data))
        };
    </script>
</body>

</html>